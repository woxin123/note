# WebSocket 详解

[TOC]

### WebSocket 出现前

构建网络应用的过程中，我们经常需要与服务器进行持续的通讯以保持双方信息的同步。通常这种持久通讯在不刷新页面的情况下进行，消耗一定的内存资源常驻后台，并且对用户不可见。在 WebSocket 出现之前，我们有下面的解决方案：

#### 传统轮询（Traditional Polling）

传统轮询是程序每隔一定的时间就去请求后台的服务器。

#### 长轮询（Long Polling）

传统的轮询存在着一个严重的缺陷：程序在每次请求时都会新建一个 HTTP 请求，然而并不是每次都能返回所需的新数据。当同时发起一个请求达到一定数目时，会对服务器造成比较大的负担。这是我们可以采用长轮询的方式解决这个问题。

>长轮询与一下将要提到的服务器发送时间和 WebSocket 不仅仅依靠客户端 JavaScript 实现，我们同时需要服务器支持并实现相应的技术。

长轮询的基本思想是在每次客户端发出请求后，服务器检查上次返回的数据与此次请求的数据之间是否有更新，如果有更新则返回新数据并结束此次连接，否则服务器 hold 住此次连接，直到有新数据再返回响应。而这种长时间的保持连接可以通过一个较大的 HTTP timeout 实现。

长轮询可以有效地解决传统轮询带来的带宽浪费，但是每次连接的保持是以消耗服务器资源为代价的。

### WebSocket 是什么

WebSocket 协议在 2008 年诞生，2011 年称为国际标准。所有的浏览器都支持了。

WebSocket 同样是 HTML5 规范的组成部分之一，先标准为 RFC 6455。WebSocket 相较于上述几种连接方式，实现原理较为复杂，用一句话概括就是：客户端向 WebSocket 服务器通知（notify）一个带有所有者 接受者（recipients IDs）的事件，服务器接收后立即通知所有活跃的（active）客户端，只有ID在接受者ID序列中的客户端才会处理这个事件。由于 WebSokcet 本身是基于 TCP 协议的，所以在服务器端我们可以采用构建 TCP Socket服务器的方式来构建的 WebSocket 服务器。




-------------------------------

来自：https://segmentfault.com/a/1190000012948613