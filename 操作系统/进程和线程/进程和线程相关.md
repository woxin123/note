# 进程和线程相关

### 进程和线程的区别

+ 进程是一个正在执行的程序的实例，是系统进行资源调度和分配的基本单位，实现了操作系统的并发；
+ 进程在执行的过程中拥有独立的内存单元，而多个线程共享进程的内存。
+ 进程拥有自己独立的地址空间，某进程内的线程对其他进程不可见。即进程 A 不能通过传地址的方式直接读写进程 B 的存储区域。进程之间需要通过进程间通信（Inter-process communication, IPC)。与之相对的，同一进程的各线程之间可以通过直接传地址或全局变量的方式传递消息。
+ **进程作为操作系统中拥有资源和独立调度的基本单位，可以拥有多个线程。** 通常操作系统中运行的一个程序就对应一个线程。在同一进程中，线程的切换不会引起进程的切换。在不同的进程中进行线程切换，如从一个进程内的线程切换到另一个进程中的线程时，会引起进程切换。**相比进程切换，线程切换的开销要小很多。线程与进程互相结合能够提高系统的运行效率。**

#### 线程可以分为两类

+ 用户级线程（user level thread):对于这类线程，油管线程管理的所有工作都由应用程序完成，内核意识不到线程的存在。在应用程序启动后，操作系统分配给该应用程序一个进程号，以及其对应的内存空间等资源。应用程序通常先在一个进程中运行，该线程被称为主线程，在其运行的某个时刻，可以通过调用线程库中的函数创建一个在相同进程中运行的线程。**用户级线程的好处就是非常高效，不需要进入内核空间，但并发效率不高。
+ 内核级线程（kernel level thread):对于这类线程，有关线程管理的所有工作由内核完成，应用程序没有进程线程管理的代码，只能调用内核的线程接口。内核维护进程机器内部的每一个线程，调用也由内核完成。内核级线程的好处是，内核可以讲不同的线程更好地分配到不同的 CPU，以实现真正的并行计算。

**事实上，在现代操作系统中，往往使用组合的方式实现多线程，级线程创建完成在用户空间完成，并且一个应用程序中的多个线程被应到一些内核级线程上，相当于是一种折中的方案。**

### 进程间通信的几种方式

+ 管道（pipe）及命名管道（named pipe）：管道可用于具有亲缘关系的父子进程间的通信，有有名管道具有管道所具有的所有功能外，它还具有无亲缘关系进程间的通信。管道和有名管道都是一种半双工的通信方式。

+ 信号（signal）：信号是一种比较复杂的通信方式，用于通知接收进程某个事件已经发生；

+ 消息队列：消息队列是消息链接表，存放在内存中并由消息队列标识符标识。消息队列客服了信息传递信息少、管道只能承载无格式字节流以及缓冲区大小受限等缺点。

+ 共享内存通信：共享内存就是映射一段能被其他进程锁访问的内存，这段内存由一个进程创建，但多个进程都可以访问。共享内存是最快的 IPC 方式，它是针对其他进程间通信方式运行效率低而专门设计的。它往往与其他通信机制，如信号量配合使用，来实现进程间的同步和通信。

+ 套接子通信：套接子（socket）：套接子也是一种进程间通信的机制，与其他通信机制不同，它可用于不同机器间的进程通信。

+ 信号量：主要作为进程之间及一种进程的不同线程之间的同步和互斥手段。

### 进程的状态转换

![](https://user-gold-cdn.xitu.io/2017/5/22/412498f4ecd2c25f4294653969aace75?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

